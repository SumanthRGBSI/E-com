<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Kitchen - Order Management</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons for a modern look -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom styles for a polished and modern UI */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F7F8FA; /* A lighter, cleaner background */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        
        /* Custom scrollbar for a refined look */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a5b4fc; }
        
        /* Active navigation link style */
        .nav-link-active {
            background-color: #FB923C; /* A vibrant orange for the food theme */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .bottom-nav-link-active {
            color: #F97316;
        }
        
        /* General transition for interactive elements */
        .transition-all { transition: all 0.2s ease-in-out; }

        /* Toast Notification Styles */
        .toast {
            position: fixed;
            bottom: 80px; /* Adjusted for bottom nav */
            right: 20px;
            left: 20px;
            sm:left: auto;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1050;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background-color: #10B981; }
        .toast.error { background-color: #EF4444; }

        /* Availability Toggle Switch Styles */
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .toggle-switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #F97316; }
        input:checked + .slider:before { transform: translateX(18px); }
        
        /* Enhanced Skeleton Loader */
        @keyframes pulse { 50% { opacity: .6; } }
        .skeleton { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        /* Order Tracking Timeline */
        .timeline-item .timeline-marker {
            position: absolute;
            left: -9px;
            top: 0;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 3px solid white;
        }
        .timeline-item.completed .timeline-marker { background-color: #10B981; }
        .timeline-item.active .timeline-marker { background-color: #3B82F6; animation: pulse 2s infinite; }
        .timeline-item.pending .timeline-marker { background-color: #D1D5DB; }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Main Application Container -->
    <div id="app" class="min-h-screen">

        <!-- Login Screen -->
        <div id="auth-screen" class="flex items-center justify-center min-h-screen bg-gradient-to-br from-orange-50 via-white to-amber-50">
            <div class="w-full max-w-md p-8 space-y-8 bg-white/70 backdrop-blur-xl rounded-2xl shadow-2xl shadow-orange-100 mx-4">
                <div class="text-center">
                    <i data-lucide="utensils-crossed" class="w-16 h-16 mx-auto text-orange-500"></i>
                    <h2 class="mt-6 text-3xl font-extrabold text-gray-900">
                        Welcome to My Kitchen
                    </h2>
                    <p class="mt-2 text-sm text-gray-600">
                        Delicious food, delivered to your door.
                    </p>
                </div>
                <div class="flex flex-col space-y-4">
                     <button onclick="login('customer')" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-xl shadow-sm text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all transform hover:scale-105">
                        <i data-lucide="shopping-bag" class="w-5 h-5 mr-2"></i>
                        Order Food
                    </button>
                    <button onclick="login('owner')" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-xl shadow-sm text-sm font-medium text-white bg-gray-700 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all transform hover:scale-105">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 mr-2"></i>
                        Kitchen Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Application Interface (Hidden by default) -->
        <div id="main-app" class="hidden">
            <!-- Sidebar Navigation (Desktop) -->
            <aside id="sidebar" class="hidden sm:block fixed top-0 left-0 z-40 w-64 h-screen">
                <div class="h-full px-4 py-6 overflow-y-auto bg-gray-800 text-white flex flex-col">
                    <a href="#" class="flex items-center ps-2.5 mb-8">
                        <i data-lucide="utensils-crossed" class="w-8 h-8 text-white"></i>
                        <span class="self-center text-xl font-semibold whitespace-nowrap ml-2">My Kitchen</span>
                    </a>
                    <ul id="nav-links" class="space-y-2 font-medium flex-grow">
                        <!-- Desktop navigation links will be dynamically inserted here -->
                    </ul>
                    <div class="mt-auto">
                         <button onclick="logout()" class="w-full flex items-center p-3 text-gray-300 rounded-lg hover:bg-gray-700 group transition-all">
                            <i data-lucide="log-out" class="w-5 h-5 text-gray-400"></i>
                            <span class="ms-3">Logout</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <div id="main-content-wrapper" class="sm:ml-64 bg-gray-50 h-screen flex flex-col">
                <!-- Header -->
                <header id="main-header" class="flex justify-between items-center p-4 md:p-6 bg-white sm:bg-gray-50 w-full z-20 border-b border-gray-200 fixed sm:static top-0">
                    <div class="flex items-center">
                         <h1 id="page-title" class="text-xl md:text-3xl font-bold text-gray-900 truncate">Dashboard</h1>
                    </div>
                    <div id="header-actions" class="flex items-center space-x-2 md:space-x-4">
                        <!-- Header actions/buttons will be dynamically inserted here -->
                    </div>
                </header>
                
                <!-- Dynamic Content -->
                <div id="content-area" class="flex-grow p-4 md:p-6 overflow-y-auto pt-20 sm:pt-4 pb-24 sm:pb-6">
                    <!-- Page content will be dynamically rendered here -->
                </div>
            </div>
            
            <!-- Bottom Navigation (Mobile) -->
            <nav id="bottom-nav" class="sm:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-[0_-1px_4px_rgba(0,0,0,0.06)] z-30">
                 <ul id="bottom-nav-links" class="flex justify-around items-center h-16">
                    <!-- Mobile navigation links will be dynamically inserted here -->
                 </ul>
            </nav>

            <!-- View Cart Bar -->
            <div id="view-cart-bar" onclick="navigate('cart')" class="hidden fixed bottom-[70px] sm:bottom-6 left-1/2 -translate-x-1/2 w-[92%] sm:w-auto sm:max-w-md bg-orange-600 p-3 rounded-lg shadow-2xl cursor-pointer transition-all duration-300 opacity-0 translate-y-4 z-40">
                <!-- Content injected by JS -->
            </div>
        </div>
        
        <!-- Modals Container -->
        <div id="modal-container"></div>
        
        <!-- Toast Notification Container -->
        <div id="toast-container"></div>
    </div>

    <script>
        // --- MOCK DATA: Single Kitchen System ---
        const mockDatabase = {
            kitchen: {
                restaurantId: 1, name: 'The Owner\'s Kitchen', address: 'Koramangala, Bangalore', cuisineTypes: ['North Indian', 'Biryani', 'Italian'], averageRating: 4.5, preparationTime: 25, deliveryTime: 35, imageUrl: 'https://placehold.co/600x400/FB923C/FFFFFF?text=My+Kitchen',
                menu: [
                    { foodItemId: 101, name: 'Hyderabadi Chicken Biryani', description: 'Aromatic basmati rice cooked with succulent chicken and spices.', dietaryInfo: ['Non-Veg'], available: true, imageUrl: 'https://placehold.co/300x200/ffedd5/fb923c?text=Biryani',
                      packagingOptions: [ { boxType: 'Regular', price: 320 }, { boxType: 'Large', price: 450 }, { boxType: 'Family Pack', price: 850 } ]
                    },
                    { foodItemId: 102, name: 'Paneer Tikka Masala', description: 'Grilled cottage cheese in a spicy tomato-based gravy.', dietaryInfo: ['Veg', 'Contains Dairy'], available: true, imageUrl: 'https://placehold.co/300x200/fecaca/ef4444?text=Paneer',
                      packagingOptions: [ { boxType: 'Regular', price: 280 }, { boxType: 'Large', price: 400 } ]
                    },
                    { foodItemId: 201, name: 'Margherita Pizza', description: 'Classic pizza with fresh tomatoes, mozzarella cheese, and basil.', dietaryInfo: ['Veg'], available: true, imageUrl: 'https://placehold.co/300x200/dbeafe/3b82f6?text=Pizza',
                      packagingOptions: [ { boxType: 'Medium (10")', price: 450 }, { boxType: 'Large (12")', price: 650 } ]
                    },
                    { foodItemId: 103, name: 'Gulab Jamun (2 pcs)', description: 'Soft, spongy balls made of milk solids, soaked in sugar syrup.', dietaryInfo: ['Veg', 'Dessert'], available: false, imageUrl: 'https://placehold.co/300x200/e9d5ff/a855f7?text=Dessert',
                      packagingOptions: [ { boxType: 'Standard', price: 80 } ]
                    }
                ],
                inventory: { packaging: [ { boxType: 'Regular', stock: 150 }, { boxType: 'Large', stock: 100 }, { boxType: 'Family Pack', stock: 40 }, { boxType: 'Medium (10")', stock: 200 }, { boxType: 'Large (12")', stock: 150 } ], ingredients: [ { name: 'Chicken', stockKg: 25 }, { name: 'Paneer', stockKg: 15 }, { name: 'Pizza Base', stockKg: 50 } ] }
            },
            orders: [
                { orderId: 1005, customerId: 3, items: [{ foodItemId: 101, name: 'Hyderabadi Chicken Biryani', boxType: 'Family Pack', quantity: 1, unitPrice: 850, totalPrice: 850 }], deliveryAddress: 'Startup Hub, HSR Layout', orderStatus: 'Order Placed', orderTime: '2025-08-19T12:25:00Z', estimatedDelivery: '2025-08-19T13:00:00Z', totalAmount: 900, paymentStatus: 'Paid' },
                { orderId: 1001, customerId: 1, items: [{ foodItemId: 101, name: 'Hyderabadi Chicken Biryani', boxType: 'Large', quantity: 1, unitPrice: 450, totalPrice: 450 }], deliveryAddress: '42, Tech Park Avenue', orderStatus: 'Delivered', orderTime: '2025-08-19T10:30:00Z', estimatedDelivery: '2025-08-19T11:05:00Z', actualDelivery: '2025-08-19T11:02:00Z', totalAmount: 485, paymentStatus: 'Paid' },
                { orderId: 1002, customerId: 1, items: [{ foodItemId: 201, name: 'Margherita Pizza', boxType: 'Medium (10")', quantity: 2, unitPrice: 450, totalPrice: 900 }], deliveryAddress: '101, Innovation Tower', orderStatus: 'Out for Delivery', orderTime: '2025-08-19T12:05:00Z', estimatedDelivery: '2025-08-19T12:35:00Z', totalAmount: 960, paymentStatus: 'Paid' },
                { orderId: 1003, customerId: 2, items: [{ foodItemId: 102, name: 'Paneer Tikka Masala', boxType: 'Regular', quantity: 1, unitPrice: 280, totalPrice: 280 }], deliveryAddress: 'Apt 5B, Silicon Valley', orderStatus: 'Food Ready for Pickup', orderTime: '2025-08-19T12:15:00Z', estimatedDelivery: '2025-08-19T12:50:00Z', totalAmount: 310, paymentStatus: 'Paid' },
                { orderId: 1004, customerId: 1, items: [{ foodItemId: 102, name: 'Paneer Tikka Masala', boxType: 'Large', quantity: 2, unitPrice: 400, totalPrice: 800 }], deliveryAddress: '42, Tech Park Avenue', orderStatus: 'Order Confirmed by Restaurant', orderTime: '2025-08-19T12:20:00Z', estimatedDelivery: '2025-08-19T12:45:00Z', totalAmount: 850, paymentStatus: 'Paid' }
            ],
            cart: {
                items: []
            },
            userProfile: {
                customer: {
                    name: "Alex Doe",
                    addresses: [
                        { id: 1, type: 'Home', line1: '42, Tech Park Avenue', city: 'Bangalore', state: 'Karnataka', zip: '560066', default: true },
                        { id: 2, type: 'Work', line1: '101, Innovation Tower', city: 'Bangalore', state: 'Karnataka', zip: '560001', default: false }
                    ]
                },
                owner: {
                    name: "Restaurant Owner"
                }
            }
        };

        // --- APPLICATION STATE ---
        let state = { currentUser: null, currentPage: null };
        
        // --- DOM ELEMENTS ---
        const authScreen = document.getElementById('auth-screen');
        const mainApp = document.getElementById('main-app');
        const sidebar = document.getElementById('sidebar');
        const navLinks = document.getElementById('nav-links');
        const bottomNavLinks = document.getElementById('bottom-nav-links');
        const pageTitle = document.getElementById('page-title');
        const headerActions = document.getElementById('header-actions');
        const contentArea = document.getElementById('content-area');
        const modalContainer = document.getElementById('modal-container');
        const toastContainer = document.getElementById('toast-container');

        // --- UI CONFIGURATION ---
        const uiConfig = {
            customer: {
                nav: [
                    { id: 'menu', label: 'Menu', icon: 'utensils', default: true },
                    { id: 'orders', label: 'Orders', icon: 'package' },
                    { id: 'cart', label: 'Cart', icon: 'shopping-cart' },
                    { id: 'profile', label: 'Profile', icon: 'user' }
                ],
                pages: {
                    menu: { title: 'Order Food', render: renderMenu },
                    cart: { title: 'Your Cart', render: renderCart },
                    orders: { title: 'Your Orders', render: renderCustomerOrders },
                    profile: { title: 'My Profile', render: renderProfile }
                }
            },
            owner: {
                nav: [
                    { id: 'dashboard', label: 'Dashboard', icon: 'home', default: true },
                    { id: 'orders', label: 'Live Orders', icon: 'inbox' },
                    { id: 'menu', label: 'Manage Menu', icon: 'book-open' },
                    { id: 'inventory', label: 'Inventory', icon: 'archive' },
                    { id: 'profile', label: 'Profile', icon: 'user' }
                ],
                pages: {
                    dashboard: { title: 'Dashboard', render: renderOwnerDashboard },
                    orders: { title: 'Live Orders', render: renderOwnerOrders },
                    menu: { title: 'Menu Management', render: renderMenuManagement },
                    inventory: { title: 'Inventory', render: renderOwnerInventory },
                    profile: { title: 'My Profile', render: renderProfile }
                }
            }
        };

        // --- CORE FUNCTIONS ---
        function init() {
            lucide.createIcons();
        }

        function login(role) {
            state.currentUser = role;
            authScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            setupUIForRole(role);
        }

        function logout() {
            state.currentUser = null;
            state.currentPage = null;
            mainApp.classList.add('hidden');
            authScreen.classList.remove('hidden');
            contentArea.innerHTML = '';
            navLinks.innerHTML = '';
            bottomNavLinks.innerHTML = '';
            mockDatabase.cart = { items: [] }; // Clear cart on logout
            updateCartState();
        }

        function setupUIForRole(role) {
            const config = uiConfig[role];
            
            navLinks.innerHTML = config.nav.map(link => `
                <li>
                    <a href="#" id="nav-${link.id}" onclick="navigate('${link.id}')" class="flex items-center p-3 text-gray-300 rounded-lg hover:bg-gray-700 group transition-all">
                        <i data-lucide="${link.icon}" class="w-5 h-5 text-gray-400"></i>
                        <span class="ms-3 flex-1 whitespace-nowrap">${link.label}</span>
                    </a>
                </li>`).join('');

            bottomNavLinks.innerHTML = config.nav.map((link) => {
                return `
                    <li>
                        <a href="#" id="bottom-nav-${link.id}" onclick="navigate('${link.id}')" class="flex flex-col items-center justify-center text-gray-500 hover:text-orange-600 transition-colors pt-2 relative">
                            <i data-lucide="${link.icon}" class="w-6 h-6"></i>
                            <span class="text-xs mt-1">${link.label}</span>
                            ${link.id === 'cart' && role === 'customer' ? `<span id="cart-bubble" class="absolute top-0 right-2 inline-flex items-center justify-center w-5 h-5 text-xs font-semibold text-white bg-orange-500 rounded-full">0</span>` : ''}
                        </a>
                    </li>
                `;
            }).join('');
            
            const defaultPage = config.nav.find(link => link.default).id;
            navigate(defaultPage);
            if (role === 'customer') updateCartState();
            lucide.createIcons();
        }

        function navigate(pageId) {
            state.currentPage = pageId;
            const config = uiConfig[state.currentUser];
            const page = config.pages[pageId];
            
            pageTitle.textContent = page.title;
            
            document.querySelectorAll('#nav-links a').forEach(link => link.classList.remove('nav-link-active'));
            document.querySelectorAll('#bottom-nav-links a').forEach(link => link.classList.remove('bottom-nav-link-active'));
            
            const desktopLink = document.getElementById(`nav-${pageId}`);
            if(desktopLink) desktopLink.classList.add('nav-link-active');
            
            const mobileLink = document.getElementById(`bottom-nav-${pageId}`);
            if (mobileLink) {
                mobileLink.classList.add('bottom-nav-link-active');
            }
            
            updateCartState(); // Update cart bar visibility based on page
            contentArea.innerHTML = renderSkeletonLoader('list');
            setTimeout(() => {
                page.render();
                lucide.createIcons();
            }, 300);
        }
        
        // --- RENDER FUNCTIONS (CUSTOMER) ---
        function renderMenu() {
            headerActions.innerHTML = '';
            const kitchen = mockDatabase.kitchen;
            contentArea.innerHTML = `
                <div class="space-y-8">
                    <!-- Restaurant Header -->
                    <div class="bg-white rounded-2xl shadow-lg p-5">
                        <h2 class="text-3xl font-bold text-gray-900">${kitchen.name}</h2>
                        <p class="text-gray-500 mt-1">${kitchen.cuisineTypes.join(', ')}</p>
                        <div class="flex items-center space-x-4 mt-3 text-sm text-gray-700 flex-wrap">
                            <div class="flex items-center"><i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current mr-1"></i> <b>${kitchen.averageRating}</b></div>
                            <div class="flex items-center"><i data-lucide="clock" class="w-4 h-4 text-gray-500 mr-1"></i> ${kitchen.preparationTime}-${kitchen.deliveryTime} min</div>
                            <div class="flex items-center"><i data-lucide="map-pin" class="w-4 h-4 text-gray-500 mr-1"></i> ${kitchen.address}</div>
                        </div>
                    </div>

                    <!-- Menu Items -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${kitchen.menu.map(item => `
                            <div class="bg-white rounded-2xl shadow-lg overflow-hidden transition-transform transform hover:-translate-y-1">
                                <div class="relative">
                                    <img src="${item.imageUrl}" alt="${item.name}" class="w-full h-48 object-cover">
                                    ${!item.available ? `<div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"><span class="text-white font-bold text-lg bg-red-500 px-3 py-1 rounded-md">Unavailable</span></div>` : ''}
                                </div>
                                <div class="p-5">
                                    <h3 class="text-xl font-bold truncate">${item.name}</h3>
                                    <p class="text-gray-600 text-sm mt-1 h-10">${item.description}</p>
                                    <div class="mt-4 space-y-2">
                                        ${item.packagingOptions.map(opt => `
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <span class="font-semibold">${opt.boxType}</span>
                                                    <span class="text-gray-800 font-bold ml-2">₹${opt.price}</span>
                                                </div>
                                                ${item.available ? `<button onclick="addToCart(${item.foodItemId}, '${opt.boxType}')" class="px-4 py-1.5 text-sm font-bold text-orange-600 bg-orange-100 rounded-lg hover:bg-orange-500 hover:text-white transition-all">ADD</button>` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderCart() {
            headerActions.innerHTML = '';
            if (mockDatabase.cart.items.length === 0) {
                contentArea.innerHTML = `<div class="text-center py-16"><i data-lucide="shopping-cart" class="w-24 h-24 mx-auto text-gray-300"></i><h3 class="mt-4 text-xl font-semibold">Your cart is empty</h3><p class="text-gray-500 mt-1">Add items from the menu to get started.</p><button onclick="navigate('menu')" class="mt-6 px-5 py-2.5 bg-orange-500 text-white rounded-md hover:bg-orange-600 font-semibold">Browse Menu</button></div>`;
                return;
            }
            
            const kitchen = mockDatabase.kitchen;
            const subtotal = mockDatabase.cart.items.reduce((sum, item) => sum + item.totalPrice, 0);
            const deliveryFee = 30;
            const taxes = subtotal * 0.05;
            const total = subtotal + deliveryFee + taxes;

            contentArea.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-4">
                        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                            <h3 class="text-xl font-bold mb-2">Ordering from</h3>
                            <p class="font-semibold text-lg text-gray-800">${kitchen.name}</p>
                            <p class="text-sm text-gray-500">${kitchen.address}</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                            <h3 class="text-xl font-bold mb-4">Cart Items (${mockDatabase.cart.items.length})</h3>
                            <ul class="divide-y divide-gray-200">
                            ${mockDatabase.cart.items.map(item => `
                                <li class="flex items-center justify-between py-4">
                                    <div>
                                        <p class="font-semibold text-lg">${item.name}</p>
                                        <p class="text-sm text-gray-500">${item.boxType}</p>
                                        <div class="flex items-center mt-2">
                                            <button onclick="updateCartQuantity(${item.foodItemId}, '${item.boxType}', -1)" class="w-7 h-7 flex items-center justify-center border rounded-md text-orange-600 hover:bg-orange-100">-</button>
                                            <span class="px-4 font-semibold">${item.quantity}</span>
                                            <button onclick="updateCartQuantity(${item.foodItemId}, '${item.boxType}', 1)" class="w-7 h-7 flex items-center justify-center border rounded-md text-orange-600 hover:bg-orange-100">+</button>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-lg">₹${item.totalPrice.toLocaleString('en-IN')}</p>
                                        <button onclick="removeFromCart(${item.foodItemId}, '${item.boxType}')" class="text-red-500 hover:text-red-700 mt-1"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                    </div>
                                </li>
                            `).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 h-fit">
                        <h3 class="text-xl font-bold mb-4">Bill Details</h3>
                        <div class="space-y-3 text-gray-600">
                            <div class="flex justify-between"><p>Item Total</p><p class="font-medium">₹${subtotal.toLocaleString('en-IN')}</p></div>
                            <div class="flex justify-between"><p>Delivery Fee</p><p class="font-medium">₹${deliveryFee.toLocaleString('en-IN')}</p></div>
                            <div class="flex justify-between"><p>Taxes & Charges</p><p class="font-medium">₹${taxes.toFixed(2)}</p></div>
                            <div class="flex justify-between text-lg font-bold text-gray-800 pt-3 border-t"><p>To Pay</p><p>₹${total.toFixed(2)}</p></div>
                        </div>
                        <button onclick="placeOrder()" class="mt-6 w-full py-3 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition-all flex items-center justify-center"><i data-lucide="lock" class="w-5 h-5 mr-2"></i> Proceed to Pay</button>
                    </div>
                </div>`;
        }

        function renderCustomerOrders() {
            headerActions.innerHTML = '';
            const orders = mockDatabase.orders.filter(o => o.customerId === 1).sort((a,b) => new Date(b.orderTime) - new Date(a.orderTime));
            const kitchen = mockDatabase.kitchen;
            contentArea.innerHTML = `<div class="space-y-4">${orders.map(order => `
                <div class="bg-white rounded-xl shadow-lg p-4 space-y-3">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-gray-800">${kitchen.name}</p>
                            <p class="text-sm text-gray-500">${kitchen.address.split(',')[0]}</p>
                            <p class="text-xs text-gray-500 mt-1">Order #${order.orderId} &bull; ${new Date(order.orderTime).toLocaleDateString()}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusClass(order.orderStatus)}">${order.orderStatus}</span>
                    </div>
                    <div class="border-t pt-2">
                        <p class="text-sm">${order.items.map(i => `${i.name} (${i.boxType}) x ${i.quantity}`).join(', ')}</p>
                    </div>
                    <div class="pt-2 border-t flex justify-between items-center">
                         <p class="font-semibold">Total: ₹${order.totalAmount.toLocaleString('en-IN')}</p>
                         <button onclick="openTrackOrderModal(${order.orderId})" class="text-sm p-2 rounded-md bg-orange-100 text-orange-700 hover:bg-orange-200 font-semibold flex items-center justify-center"><i data-lucide="truck" class="w-4 h-4 mr-1"></i>Track Order</button>
                    </div>
                </div>`
            ).join('')}</div>`;
        }

        function renderProfile() {
            headerActions.innerHTML = '';
            const user = mockDatabase.userProfile[state.currentUser];
            contentArea.innerHTML = `
                <div class="max-w-md mx-auto bg-white rounded-2xl shadow-lg p-8 space-y-6">
                    <div class="text-center">
                        <i data-lucide="user-circle-2" class="w-24 h-24 mx-auto text-orange-500"></i>
                        <h2 class="text-2xl font-bold mt-4">${user.name}</h2>
                        <p class="text-gray-500 capitalize">${state.currentUser} Account</p>
                    </div>
                    <button onclick="logout()" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-xl shadow-sm text-sm font-medium text-white bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all">
                        <i data-lucide="log-out" class="w-5 h-5 mr-2"></i>
                        Logout
                    </button>
                </div>
            `;
        }
        
        // --- RENDER FUNCTIONS (OWNER) ---
        function renderOwnerDashboard() {
            headerActions.innerHTML = '';
            const myOrders = mockDatabase.orders;
            const totalRevenue = myOrders.reduce((sum, order) => sum + order.totalAmount, 0);
            const newOrders = myOrders.filter(o => o.orderStatus === 'Order Placed');

            contentArea.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><div class="bg-green-100 p-3 rounded-full mr-4"><i data-lucide="dollar-sign" class="w-8 h-8 text-green-600"></i></div><div><p class="text-sm text-gray-500">Total Revenue</p><p class="text-2xl lg:text-3xl font-bold">₹${totalRevenue.toLocaleString()}</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><div class="bg-blue-100 p-3 rounded-full mr-4"><i data-lucide="inbox" class="w-8 h-8 text-blue-600"></i></div><div><p class="text-sm text-gray-500">Total Orders</p><p class="text-2xl lg:text-3xl font-bold">${myOrders.length}</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><div class="bg-orange-100 p-3 rounded-full mr-4"><i data-lucide="bell" class="w-8 h-8 text-orange-600"></i></div><div><p class="text-sm text-gray-500">New Orders</p><p class="text-2xl lg:text-3xl font-bold">${newOrders.length}</p></div></div>
                </div>
                <div class="mt-8 bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold mb-4">Incoming Orders</h3>
                    ${newOrders.length > 0 ? renderOwnerOrders(true) : '<div class="text-center py-8"><i data-lucide="coffee" class="w-16 h-16 mx-auto text-gray-300"></i><p class="text-gray-500 mt-2">No new orders at the moment. Time for a break!</p></div>'}
                </div>
            `;
            lucide.createIcons();
        }

        function renderMenuManagement() {
            headerActions.innerHTML = `<button onclick="openMenuItemModal()" class="flex items-center bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 font-semibold shadow-md"><i data-lucide="plus" class="w-5 h-5 mr-2"></i>Add Item</button>`;
            const kitchen = mockDatabase.kitchen;
            contentArea.innerHTML = `<div class="space-y-4">${kitchen.menu.map(item => `
                <div class="bg-white rounded-xl shadow-lg p-4">
                    <div class="flex justify-between items-start">
                        <div class="min-w-0">
                            <p class="font-bold text-gray-800 truncate">${item.name}</p>
                            <p class="text-sm text-gray-500 mt-1">${item.description}</p>
                            <div class="mt-2 text-sm text-gray-700">
                                ${item.packagingOptions.map(p => `<span>${p.boxType}: <b>₹${p.price}</b></span>`).join(' &bull; ')}
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 flex-shrink-0 ml-4">
                            <label class="toggle-switch"><input type="checkbox" ${item.available ? 'checked' : ''} onchange="toggleMenuItemAvailability(${item.foodItemId})"><span class="slider"></span></label>
                            <button onclick="openMenuItemModal(${item.foodItemId})" class="p-2 text-blue-600 hover:bg-blue-100 rounded-full"><i data-lucide="edit-2" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                </div>
            `).join('')}</div>`;
        }

        function renderOwnerOrders(isDashboard = false) {
            let ordersToDisplay = mockDatabase.orders.sort((a,b) => new Date(b.orderTime) - new Date(a.orderTime));
            if (isDashboard) {
                ordersToDisplay = ordersToDisplay.filter(o => o.orderStatus === 'Order Placed');
            }
            
            const getActionButtons = (order) => {
                const statuses = ['Order Placed', 'Order Confirmed by Restaurant', 'Food Preparation Started', 'Food Ready for Pickup', 'Out for Delivery'];
                const currentIdx = statuses.indexOf(order.orderStatus);
                if (currentIdx > -1 && currentIdx < statuses.length - 1) {
                    const nextStatus = statuses[currentIdx + 1];
                    return `<button onclick="updateOrderStatus(${order.orderId}, '${nextStatus}')" class="text-xs p-2 rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 font-semibold">Move to: ${nextStatus.replace('Order ', '').replace(' by Restaurant', '')}</button>`;
                }
                if (order.orderStatus === 'Delivered') {
                    return `<span class="text-xs text-green-600 font-semibold">Completed</span>`;
                }
                return `<span class="text-xs text-gray-500">No actions</span>`;
            };

            const tableHTML = `<div class="overflow-x-auto"><table class="w-full text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th scope="col" class="px-6 py-3">Order ID</th><th scope="col" class="px-6 py-3">Items</th><th scope="col" class="px-6 py-3">Status</th><th scope="col" class="px-6 py-3">Actions</th></tr></thead><tbody>${ordersToDisplay.map(order => `
                <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium">#${order.orderId}</td>
                    <td class="px-6 py-4 break-words">${order.items.map(i => `${i.name} x ${i.quantity}`).join(', ')}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusClass(order.orderStatus)}">${order.orderStatus}</span></td>
                    <td class="px-6 py-4">${getActionButtons(order)}</td>
                </tr>`).join('')}</tbody></table></div>`;
            
            if (isDashboard) return tableHTML;
            headerActions.innerHTML = '';
            contentArea.innerHTML = `<div class="bg-white rounded-xl shadow-lg">${tableHTML}</div>`;
        }

        function renderOwnerInventory() {
            headerActions.innerHTML = '';
            const inventory = mockDatabase.kitchen.inventory;
            contentArea.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Packaging Stock</h3>
                        <ul class="space-y-3">${inventory.packaging.map(p => `
                            <li class="flex justify-between items-center">
                                <span>${p.boxType}</span>
                                <span class="font-semibold px-3 py-1 rounded-md ${p.stock < 50 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">${p.stock} units</span>
                            </li>`).join('')}</ul>
                    </div>
                     <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Ingredient Stock</h3>
                        <ul class="space-y-3">${inventory.ingredients.map(i => `
                            <li class="flex justify-between items-center">
                                <span>${i.name}</span>
                                <span class="font-semibold">${i.stockKg} kg</span>
                            </li>`).join('')}</ul>
                    </div>
                </div>
            `;
        }

        // --- EVENT HANDLERS & ACTIONS ---
        function addToCart(foodItemId, boxType) {
            const kitchen = mockDatabase.kitchen;
            const foodItem = kitchen.menu.find(i => i.foodItemId === foodItemId);
            const packaging = foodItem.packagingOptions.find(p => p.boxType === boxType);

            const cartItem = mockDatabase.cart.items.find(item => item.foodItemId === foodItemId && item.boxType === boxType);
            if (cartItem) {
                cartItem.quantity++;
                cartItem.totalPrice = cartItem.unitPrice * cartItem.quantity;
            } else {
                mockDatabase.cart.items.push({
                    foodItemId, name: foodItem.name, boxType, quantity: 1,
                    unitPrice: packaging.price, totalPrice: packaging.price
                });
            }
            showToast(`${foodItem.name} (${boxType}) added to cart!`, 'success');
            updateCartState();
        }
        
        function removeFromCart(foodItemId, boxType) {
            mockDatabase.cart.items = mockDatabase.cart.items.filter(item => !(item.foodItemId === foodItemId && item.boxType === boxType));
            updateCartState();
            if (state.currentPage === 'cart') {
                renderCart();
                lucide.createIcons();
            }
        }

        function updateCartQuantity(foodItemId, boxType, change) {
            const cartItem = mockDatabase.cart.items.find(item => item.foodItemId === foodItemId && item.boxType === boxType);
            if (cartItem) {
                cartItem.quantity += change;
                if (cartItem.quantity <= 0) {
                    removeFromCart(foodItemId, boxType);
                } else {
                    cartItem.totalPrice = cartItem.unitPrice * cartItem.quantity;
                    updateCartState();
                    if (state.currentPage === 'cart') {
                       renderCart();
                       lucide.createIcons();
                    }
                }
            }
        }
        
        function toggleMenuItemAvailability(foodItemId) {
            const item = mockDatabase.kitchen.menu.find(i => i.foodItemId === foodItemId);
            if(item) {
                item.available = !item.available;
                showToast(`${item.name} is now ${item.available ? 'available' : 'unavailable'}.`, 'success');
            }
        }

        function updateOrderStatus(orderId, newStatus) {
            const order = mockDatabase.orders.find(o => o.orderId === orderId);
            if (order) {
                order.orderStatus = newStatus;
                if (state.currentPage === 'dashboard') renderOwnerDashboard();
                else renderOwnerOrders();
                lucide.createIcons();
                showToast(`Order #${orderId} status updated to ${newStatus}.`, 'success');
            }
        }
        
        function placeOrder() {
            openConfirmationModal('Are you sure you want to place this order?', () => {
                const subtotal = mockDatabase.cart.items.reduce((sum, item) => sum + item.totalPrice, 0);
                const total = subtotal + 30 + (subtotal * 0.05); // delivery + tax
                const newOrder = {
                    orderId: Math.floor(Math.random() * 9000) + 1000,
                    customerId: 1,
                    items: JSON.parse(JSON.stringify(mockDatabase.cart.items)),
                    deliveryAddress: mockDatabase.userProfile.customer.addresses.find(a => a.default).line1,
                    orderStatus: 'Order Placed',
                    orderTime: new Date().toISOString(),
                    estimatedDelivery: new Date(Date.now() + 35 * 60 * 1000).toISOString(),
                    totalAmount: total,
                    paymentStatus: 'Paid'
                };
                mockDatabase.orders.push(newOrder);
                mockDatabase.cart = { items: [] };
                updateCartState();
                showToast('Order placed successfully!', 'success');
                navigate('orders');
            });
        }
        
        // --- MODAL & UTILITY FUNCTIONS ---
        function closeModal() {
            const modal = document.getElementById('app-modal');
            if (modal) {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.remove(), 300);
            }
        }

        function openMenuItemModal(foodItemId = null) {
            const isEditing = foodItemId !== null;
            const item = isEditing ? mockDatabase.kitchen.menu.find(i => i.foodItemId === foodItemId) : {};
            const title = isEditing ? `Edit ${item.name}` : 'Add New Menu Item';

            const modalHTML = `
                <div id="app-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity duration-300">
                    <div class="bg-white rounded-lg shadow-xl w-full max-w-lg m-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                        <div class="flex justify-between items-center p-4 border-b">
                            <h3 class="text-xl font-bold">${title}</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-1 rounded-full"><i data-lucide="x" class="w-6 h-6"></i></button>
                        </div>
                        <div class="p-6 max-h-[70vh] overflow-y-auto">
                            <form id="menu-item-form" class="space-y-4">
                                <input type="hidden" name="foodItemId" value="${foodItemId || ''}">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-gray-700">Item Name</label>
                                    <input type="text" name="name" id="name" value="${item.name || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm" required>
                                </div>
                                <div>
                                    <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                                    <textarea name="description" id="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm" required>${item.description || ''}</textarea>
                                </div>
                                <div>
                                    <label for="imageUrl" class="block text-sm font-medium text-gray-700">Image URL</label>
                                    <input type="text" name="imageUrl" id="imageUrl" value="${item.imageUrl || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm">
                                </div>
                                
                                <div id="packaging-options-container">
                                    <h4 class="text-md font-semibold text-gray-800 border-b pb-2">Packaging Options</h4>
                                    ${(item.packagingOptions || [{boxType: '', price: ''}]).map((opt, index) => `
                                        <div class="grid grid-cols-12 gap-2 mt-2 items-center packaging-option-row">
                                            <div class="col-span-5">
                                                <label class="text-xs text-gray-500">Type (e.g., Regular, 500g)</label>
                                                <input type="text" value="${opt.boxType || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" placeholder="Box Type" required>
                                            </div>
                                            <div class="col-span-5">
                                                <label class="text-xs text-gray-500">Price (₹)</label>
                                                <input type="number" value="${opt.price || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" placeholder="Price" required>
                                            </div>
                                            <div class="col-span-2 text-right">
                                                 <button type="button" onclick="this.closest('.packaging-option-row').remove()" class="mt-6 p-2 text-red-500 hover:bg-red-100 rounded-full"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <button type="button" id="add-packaging-option" class="text-sm font-semibold text-orange-600 hover:text-orange-800 flex items-center"><i data-lucide="plus-circle" class="w-4 h-4 mr-1"></i>Add another option</button>
                            </form>
                        </div>
                        <div class="flex justify-end p-4 bg-gray-50 border-t">
                            <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold mr-2">Cancel</button>
                            <button onclick="saveMenuItem()" class="px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 font-semibold">Save Changes</button>
                        </div>
                    </div>
                </div>`;
            
            modalContainer.innerHTML = modalHTML;
            lucide.createIcons();
            
            document.getElementById('add-packaging-option').addEventListener('click', () => {
                const container = document.getElementById('packaging-options-container');
                const newRow = document.createElement('div');
                newRow.className = 'grid grid-cols-12 gap-2 mt-2 items-center packaging-option-row';
                newRow.innerHTML = `
                    <div class="col-span-5">
                        <label class="text-xs text-gray-500">Type (e.g., Regular, 500g)</label>
                        <input type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" placeholder="Box Type" required>
                    </div>
                    <div class="col-span-5">
                        <label class="text-xs text-gray-500">Price (₹)</label>
                        <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" placeholder="Price" required>
                    </div>
                    <div class="col-span-2 text-right">
                         <button type="button" onclick="this.closest('.packaging-option-row').remove()" class="mt-6 p-2 text-red-500 hover:bg-red-100 rounded-full"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                    </div>`;
                container.appendChild(newRow);
                lucide.createIcons();
            });

            setTimeout(() => {
                document.getElementById('app-modal').classList.remove('opacity-0');
                document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function saveMenuItem() {
            const form = document.getElementById('menu-item-form');
            const formData = new FormData(form);
            const foodItemId = parseInt(formData.get('foodItemId'));
            const isEditing = !isNaN(foodItemId);

            const packagingRows = form.querySelectorAll('.packaging-option-row');
            const packagingOptions = Array.from(packagingRows).map(row => ({
                boxType: row.children[0].querySelector('input').value,
                price: parseFloat(row.children[1].querySelector('input').value)
            })).filter(opt => opt.boxType && !isNaN(opt.price));

            if (packagingOptions.length === 0) {
                showToast('Please add at least one packaging option.', 'error');
                return;
            }

            const newItemData = {
                name: formData.get('name'),
                description: formData.get('description'),
                imageUrl: formData.get('imageUrl'),
                available: isEditing ? mockDatabase.kitchen.menu.find(i=>i.foodItemId === foodItemId).available : true,
                packagingOptions: packagingOptions
            };

            if (isEditing) {
                const itemIndex = mockDatabase.kitchen.menu.findIndex(i => i.foodItemId === foodItemId);
                if (itemIndex > -1) {
                    mockDatabase.kitchen.menu[itemIndex] = { ...mockDatabase.kitchen.menu[itemIndex], ...newItemData };
                    showToast('Item updated successfully!', 'success');
                }
            } else {
                newItemData.foodItemId = Date.now(); // Simple unique ID
                mockDatabase.kitchen.menu.push(newItemData);
                showToast('Item added successfully!', 'success');
            }

            closeModal();
            renderMenuManagement();
            lucide.createIcons();
        }


        function openConfirmationModal(message, onConfirm) {
            const modalHTML = `<div id="app-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity duration-300"><div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 m-4 text-center transform transition-all duration-300 scale-95 opacity-0" id="modal-content"><i data-lucide="alert-triangle" class="w-16 h-16 mx-auto text-orange-500"></i><h3 class="text-xl font-bold mt-4">Please Confirm</h3><p class="text-gray-600 mt-2">${message}</p><div class="flex justify-center mt-6 space-x-4"><button onclick="closeModal()" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold">Cancel</button><button id="confirm-action" class="px-6 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 font-semibold">Confirm</button></div></div></div>`;
            modalContainer.innerHTML = modalHTML;
            lucide.createIcons();
            document.getElementById('confirm-action').onclick = () => { onConfirm(); closeModal(); };
            setTimeout(() => {
                document.getElementById('app-modal').classList.remove('opacity-0');
                document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function updateCartState() {
            const cartBubble = document.getElementById('cart-bubble');
            const viewCartBar = document.getElementById('view-cart-bar');
            const totalItems = mockDatabase.cart.items.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = mockDatabase.cart.items.reduce((sum, item) => sum + item.totalPrice, 0);

            // Update bottom nav bubble
            if (cartBubble) {
                cartBubble.textContent = totalItems;
                cartBubble.style.display = totalItems > 0 ? 'inline-flex' : 'none';
            }

            // Update the persistent "View Cart" bar
            if (viewCartBar) {
                if (totalItems > 0 && state.currentPage === 'menu') {
                    viewCartBar.innerHTML = `
                        <div class="flex justify-between items-center w-full">
                            <div>
                                <p class="font-bold text-white">${totalItems} ${totalItems > 1 ? 'Items' : 'Item'}</p>
                                <p class="text-sm text-orange-200">₹${subtotal.toLocaleString('en-IN')} plus taxes</p>
                            </div>
                            <div class="flex items-center font-bold text-white">
                                View Cart <i data-lucide="chevron-right" class="w-5 h-5 ml-1"></i>
                            </div>
                        </div>
                    `;
                    viewCartBar.classList.remove('hidden');
                    setTimeout(() => viewCartBar.classList.remove('opacity-0', 'translate-y-4'), 10);
                    lucide.createIcons();
                } else {
                    viewCartBar.classList.add('opacity-0', 'translate-y-4');
                    setTimeout(() => viewCartBar.classList.add('hidden'), 300); // Hide after transition
                }
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'alert-circle'}"></i> ${message}`;
            toastContainer.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function renderSkeletonLoader(type = 'card') {
            if (type === 'list') {
                 return `<div class="space-y-4 skeleton">${Array(5).fill('').map(() => `<div class="bg-white rounded-xl shadow-lg p-4 h-24"><div class="h-full bg-gray-300 rounded-lg"></div></div>`).join('')}</div>`;
            }
            return `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 skeleton">${Array(6).fill('').map(() => `<div class="bg-white rounded-xl shadow-lg"><div class="h-40 bg-gray-300 rounded-t-xl"></div><div class="p-4 space-y-3"><div class="h-6 w-3/4 bg-gray-300 rounded"></div><div class="h-4 w-1/2 bg-gray-300 rounded"></div></div></div>`).join('')}</div>`;
        }
        
        function getStatusClass(status) {
            const classes = { 
                'Delivered': 'bg-green-100 text-green-800', 
                'Out for Delivery': 'bg-cyan-100 text-cyan-800',
                'Food Ready for Pickup': 'bg-purple-100 text-purple-800',
                'Food Preparation Started': 'bg-yellow-100 text-yellow-800',
                'Order Confirmed by Restaurant': 'bg-blue-100 text-blue-800',
                'Order Placed': 'bg-orange-100 text-orange-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }
        
        function openTrackOrderModal(orderId) {
            const order = mockDatabase.orders.find(o => o.orderId === orderId);
            if (!order) return;
            const allStatuses = ['Order Placed', 'Order Confirmed by Restaurant', 'Food Preparation Started', 'Food Ready for Pickup', 'Out for Delivery', 'Delivered'];
            const currentStatusIndex = allStatuses.indexOf(order.orderStatus);
            
            const timelineHTML = allStatuses.map((status, index) => {
                let itemClass = 'pending';
                if (index < currentStatusIndex) itemClass = 'completed';
                if (index === currentStatusIndex) itemClass = 'active';
                
                return `<li class="relative pl-8 pb-8 timeline-item ${itemClass}"><div class="timeline-marker"></div><p class="font-semibold">${status}</p></li>`;
            }).join('');

            const modalHTML = `<div id="app-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity duration-300"><div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 m-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content"><div class="flex justify-between items-center pb-3 border-b"><h3 class="text-2xl font-bold">Track Order #${order.orderId}</h3><button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-1 rounded-full"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="mt-4"><p class="mb-4">Estimated Delivery: <span class="font-semibold">${new Date(order.estimatedDelivery).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span></p><ul class="border-l-2 border-gray-200">${timelineHTML}</ul></div></div></div>`;
            modalContainer.innerHTML = modalHTML;
            lucide.createIcons();
            setTimeout(() => {
                document.getElementById('app-modal').classList.remove('opacity-0');
                document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
